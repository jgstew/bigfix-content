<?xml version="1.0" encoding="UTF-8"?>
<BES xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="BES.xsd">
	<Fixlet>
		<Title>set LOG4J_FORMAT_MSG_NO_LOOKUPS env var to TRUE - Universal - CVE-2021-44228 mitigation</Title>
		<Description><![CDATA[<P>This is a partial mitigation / workaround for CVE-2021-44228.</P>
<P>This will be relevant on ALL systems that do not have this environment variable set, regardless of presents of a vulnerable Log4J jar file or even an installed Java runtime. This fixlet doesn't mean that a system is vulnerable, only that it hasn't been mitigated from potential vulnerablity.<BR><BR><STRONG>References:</STRONG></P>
<UL>
<LI><A href="https://msrc-blog.microsoft.com/2021/12/11/microsofts-response-to-cve-2021-44228-apache-log4j2/">https://msrc-blog.microsoft.com/2021/12/11/microsofts-response-to-cve-2021-44228-apache-log4j2/</A>&nbsp; 
<LI><A href="https://forum.bigfix.com/t/log4j-cve-2021-44228/40141/97">https://forum.bigfix.com/t/log4j-cve-2021-44228/40141/97</A>&nbsp;</LI></UL>]]></Description>
		<Relevance>not exists unique values whose(it contains "true") of values of (variables ("LOG4J_FORMAT_MSG_NO_LOOKUPS") of it; (if (windows of operating system) then (x64 variables ("LOG4J_FORMAT_MSG_NO_LOOKUPS") of it) else NOTHINGS) ) of environments</Relevance>
		<Category>Configuration</Category>
		<DownloadSize>0</DownloadSize>
		<Source>Internal</Source>
		<SourceID>jgstew</SourceID>
		<SourceReleaseDate>2021-12-14</SourceReleaseDate>
		<SourceSeverity>High</SourceSeverity>
		<CVENames>CVE-2021-44228</CVENames>
		<SANSID></SANSID>
		<MIMEField>
			<Name>x-fixlet-modification-time</Name>
			<Value>Tue, 14 Dec 2021 20:42:02 +0000</Value>
		</MIMEField>
		<Domain>BESC</Domain>
		<DefaultAction ID="Action1">
			<Description>
				<PreLink>Click </PreLink>
				<Link>here</Link>
				<PostLink> to deploy this action.</PostLink>
			</Description>
			<ActionScript MIMEType="application/x-Fixlet-Windows-Shell"><![CDATA[
if {windows of operating system}
waithidden CMD /C setx LOG4J_FORMAT_MSG_NO_LOOKUPS true /m

if {x64 of operating system}
action uses wow64 redirection False
waithidden CMD /C setx LOG4J_FORMAT_MSG_NO_LOOKUPS true /m
endif

endif

if {mac of operating system}

if { not exists lines containing "LOG4J_FORMAT_MSG_NO_LOOKUPS" of files "/etc/profile" }
wait /bin/sh -c '/bin/echo "export LOG4J_FORMAT_MSG_NO_LOOKUPS=true" >> /etc/profile'
endif

endif

if { unix of operating system }
if { exists folders "/etc/profile.d" AND not exists files "/etc/profile.d/CVE-2021-44228.sh" }

wait /bin/sh -c 'echo -e "export LOG4J_FORMAT_MSG_NO_LOOKUPS=true" > /etc/profile.d/CVE-2021-44228.sh'

endif
elseif {exists files "/etc/profile"}
wait /bin/sh -c '/bin/echo "export LOG4J_FORMAT_MSG_NO_LOOKUPS=true" >> /etc/profile'

endif

action requires restart]]></ActionScript>
		</DefaultAction>
	</Fixlet>
</BES>
